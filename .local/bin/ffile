#!/usr/bin/env bash

set -euo pipefail

if ! command -v fzf &> /dev/null; then
  echo "Error: fzf is not installed."
  exit 1
fi

start_dir="$HOME"

# selected_file=$(find "$start_dir" -type f | fzf ---preview 'bat --color=always {}' --preview-window 'right:60%')
selected_file=$(fd --type f --hidden --follow . "$start_dir" | fzf --preview 'bat --color=always {}' --preview-window 'right:60%')

if [[ -z "$selected_file" ]]; then
  exit 0
fi

editors=("nvim" "nano")

selected_editor=$(printf "%s\n" "${editors[@]}" | fzf --prompt="Select Editor> ")

if ! command -v "$selected_editor" &> /dev/null; then
  echo "Error: Editor '$selected_editor' not found."
  exit 1
fi

if "$selected_editor" "$selected_file"; then
  :
else
  echo "Error: Failed to open '$selected_file' with $selected_editor."
  exit 1
fi
