#!/usr/bin/env bash

set -euo pipefail

if ! command -v fzf &> /dev/null; then
  echo "Error: fzf is not installed."
  exit 1
fi

if ! command -v docker &> /dev/null; then
  echo "Error: docker is not installed."
  exit 1
fi

selected_network=$(docker network ls --format "{{.Name}}" | fzf)

if [[ -z "$selected_network" ]]; then
  exit 0
fi

options=(
  "Inspect Network"
  "Remove Network"
  "Prune Networks"
)

selected_action=$(printf "%s\n" "${options[@]}" | fzf)

case "$selected_action" in
  "Inspect Network")
    docker network inspect "$selected_network"
    ;;
  "Remove Network")
    read -p "Are you sure you want to remove network '$selected_network'? (y/N): " confirm
    if [[ "$confirm" == "y" ]]; then
      docker network rm "$selected_network"
    else
      echo "Network removal cancelled."
    fi
    ;;
  "Prune Networks")
    read -p "Are you sure you want to prune unused networks? (y/N): " confirm
    if [[ "$confirm" == "y" ]]; then
      docker network prune
    else
      echo "Network pruning cancelled."
    fi
    ;;
  *)
    echo "Invalid action selected."
    exit 1
    ;;
esac
