#!/usr/bin/env bash

set -euo pipefail

if ! command -v fzf &> /dev/null; then
  echo "Error: fzf is not installed."
  exit 1
fi

if ! command -v docker &> /dev/null; then
  echo "Error: docker is not installed."
  exit 1
fi

selected_volume=$(docker volume ls --format "{{.Name}}" | fzf)

if [[ -z "$selected_volume" ]]; then
  exit 0
fi

options=(
  "Inspect Volume"
  "Remove Volume"
  "Prune Volumes"
)

selected_action=$(printf "%s\n" "${options[@]}" | fzf)

case "$selected_action" in
  "Inspect Volume")
    docker volume inspect "$selected_volume"
    ;;
  "Remove Volume")
    read -p "Are you sure you want to remove volume '$selected_volume'? (y/N): " confirm
    if [[ "$confirm" == "y" ]]; then
      docker volume rm "$selected_volume"
    else
      echo "Volume removal cancelled."
    fi
    ;;
  "Prune Volumes")
    read -p "Are you sure you want to prune unused volumes? (y/N): " confirm
    if [[ "$confirm" == "y" ]]; then
      docker volume prune
    else
      echo "Volume pruning cancelled."
    fi
    ;;
  *)
    echo "Invalid action selected."
    exit 1
    ;;
esac
